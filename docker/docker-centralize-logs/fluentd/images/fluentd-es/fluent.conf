<source>
  @type forward
</source>

## NGINX FORMAT
<match nginx.docker.**>
   type parser
   format nginx
   remove_prefix nginx
   key_name log
   reserve_data yes
</match>

## JAVA FORMAT
<match java.docker.**>
  type parser
  format /^(?<suffix>^.*m)(?<time>\d{1,2}:\d{1,2}:\d{1,2},\d{1,3}) (?<level>[^\s]+) (?<message>.*)/
  remove_prefix java
  key_name log
  reserve_data yes
</match>

<filter docker.**>
  type concat
  key log
  stream_identity_key container_id
  multiline_start_regexp /^\S+/
  # use longer flush_interval to reduce CPU usage.
  # note that this is a trade-off against latency.
  flush_interval 60s
</filter>

<match docker.**>
  type better_timestamp
  tag elasticsearch
</match>

<match elasticsearch>
  type elasticsearch
  host "#{ENV['ES_HOST']}"
  port "#{ENV['ES_PORT']}"
  type_name "#{ENV['ES_TYPE']}"
  logstash_prefix "#{ENV['ES_INDEX']}"
  logstash_format true
  # use longer flush_interval to reduce CPU usage.
  # note that this is a trade-off against latency.
  flush_interval 60s
</match>
