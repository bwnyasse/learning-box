<source>
  @type forward
</source>

## NGINX FORMAT
<match nginx.docker.**>
   type parser
   format nginx
   remove_prefix nginx
   key_name log
   reserve_data yes
</match>

## JAVA FORMAT
<match java.docker.**>
  type parser
  format /^(?<suffix>^.*m)(?<time>\d{1,2}:\d{1,2}:\d{1,2},\d{1,3}) (?<level>[^\s]+) (?<message>.*)/
  remove_prefix java
  key_name log
  reserve_data yes
</match>

<filter docker.**>
  type concat
  key log
  stream_identity_key container_id
  multiline_start_regexp /^\S+/
  flush_interval 5s
</filter>

<match docker.**>
  type record_reformer
  time_nano ${t = Time.now; ((t.to_i * 1000000000) + t.nsec).to_s}
  tag elasticsearch
</match>

<match elasticsearch>
  type elasticsearch
  host "#{ENV['ES_HOST']}"
  port "#{ENV['ES_PORT']}"
  type_name "#{ENV['ES_TYPE']}"
  logstash_prefix "#{ENV['ES_INDEX']}"
  logstash_format true
</match>
